<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRF App - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: #007AFF;
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-name {
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .welcome-section {
            background: linear-gradient(135deg, #5abaa3 0%, #26397f 100%);
            color: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .welcome-title {
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
        }





        .actions-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
            border-left: 4px solid #5abaa3;
        }

        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(90, 186, 163, 0.2);
            border-left-color: #4a9a8a;
        }

        .action-icon {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .action-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.error {
            background: #FFE5E5;
            color: #D32F2F;
            border: 1px solid #FFCDD2;
        }

        .alert.success {
            background: rgba(90, 186, 163, 0.1);
            color: #2E7D32;
            border: 1px solid #5abaa3;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #5abaa3;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .download-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .download-section h3 {
            color: #26397f;
            margin-bottom: 15px;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }





            .actions-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">CRF App</div>
            <div class="user-info">
                <span class="user-name" id="userName">Carregando...</span>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="alert" class="alert"></div>

        <div class="welcome-section">
            <h1 class="welcome-title">Bem-vindo ao CRF App</h1>
            <p class="welcome-subtitle">Sistema de Fiscaliza√ß√£o e Monitoramento</p>
        </div>



        <!-- Se√ß√£o de Downloads Principais -->
        <div class="download-section">
            <h3>üì• Downloads de Dados</h3>
            
            <!-- Baixar Tudo -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarTudo()">
                    <div class="action-icon">üöÄ</div>
                    <div class="action-title">Baixar Tudo</div>
                    <div class="action-description">Download completo de todos os dados</div>
                </div>
            </div>

            <!-- Listar Empresas (linha inteira) -->
            <div class="actions-row">
                <div class="action-card" onclick="window.location.href='/empresas'">
                    <div class="action-icon">üìã</div>
                    <div class="action-title">Listar Empresas</div>
                    <div class="action-description">Visualizar empresas cadastradas</div>
                </div>
            </div>

            <!-- Baixar Empresas e Ver Empresas -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarEmpresas()">
                    <div class="action-icon">üì•</div>
                    <div class="action-title">Baixar Empresas</div>
                    <div class="action-description">Baixar empresas do servidor</div>
                </div>
                <div class="action-card" onclick="visualizarEmpresasLocais()" style="background-color: #ff6b6b; color: white;">
                    <div class="action-icon">üëÅÔ∏è</div>
                    <div class="action-title">Ver Empresas</div>
                    <div class="action-description">Visualizar dados locais</div>
                </div>
            </div>



            <!-- Configura√ß√£o do Termo -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarConfigTermo()">
                    <div class="action-icon">üìã</div>
                    <div class="action-title">Baixar Configura√ß√£o</div>
                    <div class="action-description">Configura√ß√£o do termo</div>
                </div>
                <div class="action-card" onclick="visualizarConfigTermo()" style="background-color: #4ecdc4; color: white;">
                    <div class="action-icon">üìã</div>
                    <div class="action-title">Ver Configura√ß√£o</div>
                    <div class="action-description">Visualizar configura√ß√£o</div>
                </div>
            </div>

            <!-- Hist√≥rico de RTS -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarRtsHistorico()">
                    <div class="action-icon">üë•</div>
                    <div class="action-title">Baixar RTS</div>
                    <div class="action-description">Hist√≥rico de RTS</div>
                </div>
                <div class="action-card" onclick="visualizarRtsHistorico()" style="background-color: #ffa726; color: white;">
                    <div class="action-icon">üë•</div>
                    <div class="action-title">Ver RTS</div>
                    <div class="action-description">Visualizar hist√≥rico RTS</div>
                </div>
            </div>

            <!-- Tipos de Inspe√ß√£o -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarTiposInspecao()">
                    <div class="action-icon">üîç</div>
                    <div class="action-title">Baixar Tipos</div>
                    <div class="action-description">Tipos de inspe√ß√£o</div>
                </div>
                <div class="action-card" onclick="visualizarTiposInspecao()" style="background-color: #9c27b0; color: white;">
                    <div class="action-icon">üîç</div>
                    <div class="action-title">Ver Tipos</div>
                    <div class="action-description">Visualizar tipos</div>
                </div>
            </div>

            <!-- Hist√≥rico de Inspe√ß√µes -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarInspecoesHistorico()">
                    <div class="action-icon">üìä</div>
                    <div class="action-title">Baixar Inspe√ß√µes</div>
                    <div class="action-description">Hist√≥rico de inspe√ß√µes</div>
                </div>
                <div class="action-card" onclick="visualizarInspecoesHistorico()" style="background-color: #e91e63; color: white;">
                    <div class="action-icon">üìä</div>
                    <div class="action-title">Ver Inspe√ß√µes</div>
                    <div class="action-description">Visualizar inspe√ß√µes</div>
                </div>
            </div>

            <!-- Protocolos -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarProtocolos()">
                    <div class="action-icon">üìÑ</div>
                    <div class="action-title">Baixar Protocolos</div>
                    <div class="action-description">Protocolos dispon√≠veis</div>
                </div>
                <div class="action-card" onclick="visualizarProtocolos()" style="background-color: #795548; color: white;">
                    <div class="action-icon">üìÑ</div>
                    <div class="action-title">Ver Protocolos</div>
                    <div class="action-description">Visualizar protocolos</div>
                </div>
            </div>

            <!-- Afastamentos -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarAfastamentos()">
                    <div class="action-icon">üè•</div>
                    <div class="action-title">Baixar Afastamentos</div>
                    <div class="action-description">Dados de afastamentos</div>
                </div>
                <div class="action-card" onclick="visualizarAfastamentos()" style="background-color: #607d8b; color: white;">
                    <div class="action-icon">üè•</div>
                    <div class="action-title">Ver Afastamentos</div>
                    <div class="action-description">Visualizar afastamentos</div>
                </div>
            </div>

            <!-- Den√∫ncias -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarDenuncias()">
                    <div class="action-icon">üö®</div>
                    <div class="action-title">Baixar Den√∫ncias</div>
                    <div class="action-description">Hist√≥rico de den√∫ncias</div>
                </div>
                <div class="action-card" onclick="visualizarDenuncias()" style="background-color: #f44336; color: white;">
                    <div class="action-icon">üö®</div>
                    <div class="action-title">Ver Den√∫ncias</div>
                    <div class="action-description">Visualizar den√∫ncias</div>
                </div>
            </div>

            <!-- Outros Profissionais -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarOutrosProfissionais()">
                    <div class="action-icon">üë®‚Äç‚öïÔ∏è</div>
                    <div class="action-title">Baixar Outros Profissionais</div>
                    <div class="action-description">Dados de outros profissionais</div>
                </div>
                <div class="action-card" onclick="visualizarOutrosProfissionais()" style="background-color: #2196f3; color: white;">
                    <div class="action-icon">üë®‚Äç‚öïÔ∏è</div>
                    <div class="action-title">Ver Outros Profissionais</div>
                    <div class="action-description">Visualizar profissionais</div>
                </div>
            </div>

            <!-- Outros V√≠nculos -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarOutrosVinculos()">
                    <div class="action-icon">üîó</div>
                    <div class="action-title">Baixar Outros V√≠nculos</div>
                    <div class="action-description">V√≠nculos profissionais</div>
                </div>
                <div class="action-card" onclick="visualizarOutrosVinculos()" style="background-color: #ff9800; color: white;">
                    <div class="action-icon">üîó</div>
                    <div class="action-title">Ver Outros V√≠nculos</div>
                    <div class="action-description">Visualizar v√≠nculos</div>
                </div>
            </div>

            <!-- Processos √âticos -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarProcessosEticos()">
                    <div class="action-icon">‚öñÔ∏è</div>
                    <div class="action-title">Baixar Processos √âticos</div>
                    <div class="action-description">Processos √©ticos</div>
                </div>
                <div class="action-card" onclick="visualizarProcessosEticos()" style="background-color: #673ab7; color: white;">
                    <div class="action-icon">‚öñÔ∏è</div>
                    <div class="action-title">Ver Processos √âticos</div>
                    <div class="action-description">Visualizar processos</div>
                </div>
            </div>
        </div>

        <!-- √Årea de Conte√∫do para Visualiza√ß√£o -->
        <div id="content"></div>


    </div>

    <script>
        const alertDiv = document.getElementById('alert');
        const userNameElement = document.getElementById('userName');

        function showAlert(message, type) {
            alertDiv.textContent = message;
            alertDiv.className = `alert ${type}`;
            alertDiv.style.display = 'block';
        }

        function hideAlert() {
            alertDiv.style.display = 'none';
        }

        function logout() {
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('user');
            window.location.href = '/';
        }



        // Fun√ß√µes de Download (usando APIs reais)
        function baixarTudo() {
            showAlert('üöÄ Iniciando download completo de todos os dados...', 'success');
            
            // Executar todos os downloads sequencialmente
            const downloads = [
                { name: 'Configura√ß√£o', func: baixarConfigTermo },
                { name: 'RTS', func: baixarRtsHistorico },
                { name: 'Tipos de Inspe√ß√£o', func: baixarTiposInspecao },
                { name: 'Inspe√ß√µes', func: baixarInspecoesHistorico },
                { name: 'Protocolos', func: baixarProtocolos },
                { name: 'Afastamentos', func: baixarAfastamentos },
                { name: 'Den√∫ncias', func: baixarDenuncias },
                { name: 'Outros Profissionais', func: baixarOutrosProfissionais },
                { name: 'Outros V√≠nculos', func: baixarOutrosVinculos },
                { name: 'Processos √âticos', func: baixarProcessosEticos }
            ];

            let completed = 0;
            let successCount = 0;
            let errorCount = 0;

            downloads.forEach((download, index) => {
                setTimeout(() => {
                    download.func().then(() => {
                        successCount++;
                        completed++;
                        if (completed === downloads.length) {
                            showAlert(`‚úÖ Download completo finalizado! ${successCount} sucessos, ${errorCount} erros`, 'success');
                        }
                    }).catch(() => {
                        errorCount++;
                        completed++;
                        if (completed === downloads.length) {
                            showAlert(`‚ö†Ô∏è Download completo finalizado! ${successCount} sucessos, ${errorCount} erros`, 'error');
                        }
                    });
                }, index * 1000); // Executar com 1 segundo de intervalo
            });
        }

        function baixarEmpresas() {
            showAlert('üì• Baixando empresas do servidor...', 'success');
            
            // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
            const user = localStorage.getItem('user');
            let iduser = '1'; // valor padr√£o
            
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    iduser = userData.id || '1';
                } catch (error) {
                    console.log('Usando ID padr√£o para usu√°rio');
                }
            }
            
            fetch('/api/empresas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `iduser=${iduser}`
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('üì• Resposta da API empresas:', data);
                
                if (data.msg === "Nenhum dado Encontrado") {
                    showAlert('‚ÑπÔ∏è Nenhuma empresa encontrada para este usu√°rio', 'success');
                    localStorage.setItem('empresas', JSON.stringify([]));
                    localStorage.setItem('empresas_timestamp', Date.now().toString());
                } else if (data.msg === "sucesso" && data[0]) {
                    // A API retorna: {"msg":"sucesso","0":{"idempresa":"517798",...},"1":{"idempresa":"...",...}}
                    const empresas = [];
                    Object.keys(data).forEach(key => {
                        if (key !== 'msg' && data[key]) {
                            // Adicionar campo 'realizado' para controle de inspe√ß√£o
                            const empresa = {
                                ...data[key],
                                realizado: false // Por padr√£o, inspe√ß√£o n√£o foi realizada
                            };
                            empresas.push(empresa);
                        }
                    });
                    
                    localStorage.setItem('empresas', JSON.stringify(empresas));
                    localStorage.setItem('empresas_timestamp', Date.now().toString());
                    showAlert(`‚úÖ ${empresas.length} empresas baixadas com sucesso!`, 'success');
                } else if (data.empresas || Array.isArray(data)) {
                    const empresas = data.empresas || data;
                    localStorage.setItem('empresas', JSON.stringify(empresas));
                    localStorage.setItem('empresas_timestamp', Date.now().toString());
                    showAlert(`‚úÖ ${empresas.length} empresas baixadas com sucesso!`, 'success');
                } else {
                    showAlert('‚ùå Formato de resposta inesperado da API', 'error');
                    console.log('Resposta inesperada:', data);
                }
            })
            .catch(error => {
                console.error('‚ùå Erro ao baixar empresas:', error);
                showAlert(`‚ùå Erro ao baixar empresas: ${error.message}`, 'error');
            });
        }

        function sincronizarDados() {
            showAlert('üîÑ Sincronizando dados com o servidor...', 'success');
            
            fetch('/api/sincronizar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('‚úÖ Sincroniza√ß√£o conclu√≠da com sucesso!', 'success');
                } else {
                    showAlert('‚ùå Erro na sincroniza√ß√£o', 'error');
                }
            })
            .catch(error => {
                console.error('Erro na sincroniza√ß√£o:', error);
                showAlert('‚ùå Erro ao sincronizar dados', 'error');
            });
        }

        function listarEmpresas() {
            console.log('üìã Listando empresas do banco local');
            
            // Buscar dados diretamente do localStorage (banco local)
            const empresas = JSON.parse(localStorage.getItem('empresas') || '[]');
            const timestamp = localStorage.getItem('empresas_timestamp');
            
            if (empresas.length === 0) {
                console.log('‚ùå Banco local vazio - nenhuma empresa encontrada');
                showAlert('‚ÑπÔ∏è Nenhuma empresa encontrada no banco local. Use "BAIXAR EMPRESAS" primeiro.', 'info');
                return;
            }
            
            // Criar lista formatada para exibi√ß√£o
            let empresasList = 'üìã **LISTA DE EMPRESAS CADASTRADAS**\n\n';
            empresas.forEach((empresa, index) => {
                const status = empresa.status || 'Ativo';
                const cidade = empresa.cidade || 'N/A';
                const realizado = empresa.realizado ? '‚úÖ Realizada' : '‚è≥ Pendente';
                const coordenadas = empresa.latitude && empresa.longitude ? 
                    `üìç ${empresa.latitude}, ${empresa.longitude}` : 'üìç Coordenadas n√£o definidas';
                
                empresasList += `**${index + 1}. ${empresa.nome}**\n`;
                empresasList += `   üÜî ID: ${empresa.idempresa || 'N/A'}\n`;
                empresasList += `   üéØ Meta: ${empresa.idmeta || 'N/A'}\n`;
                empresasList += `   üèôÔ∏è Cidade: ${cidade}\n`;
                empresasList += `   üìä Status: ${status}\n`;
                empresasList += `   üîç Inspe√ß√£o: ${realizado}\n`;
                empresasList += `   ${coordenadas}\n\n`;
            });
            
            // Mostrar lista formatada
            showAlert(empresasList, 'success');
            
            // Log detalhado no console
            console.log('üìä === DADOS COMPLETOS DO BANCO LOCAL ===');
            console.log('üïí Timestamp de download:', timestamp ? new Date(parseInt(timestamp)).toLocaleString() : 'N/A');
            console.log('üìà Total de empresas:', empresas.length);
            console.log('üóÑÔ∏è Dados brutos do localStorage:', empresas);
        }



        function visualizarEmpresasLocais() {
            console.log('üëÅÔ∏è Visualizando empresas locais');
            
            // Buscar dados diretamente do localStorage (banco local)
            const empresas = JSON.parse(localStorage.getItem('empresas') || '[]');
            const timestamp = localStorage.getItem('empresas_timestamp');
            
            // Log detalhado de tudo que est√° no banco local
            console.log('üìä === DADOS COMPLETOS DO BANCO LOCAL ===');
            console.log('üïí Timestamp de download:', timestamp ? new Date(parseInt(timestamp)).toLocaleString() : 'N/A');
            console.log('üìà Total de empresas:', empresas.length);
            console.log('üóÑÔ∏è Dados brutos do localStorage:', empresas);
            
            if (empresas.length === 0) {
                console.log('‚ùå Banco local vazio - nenhuma empresa encontrada');
                showAlert('‚ÑπÔ∏è Nenhuma empresa encontrada no banco local', 'info');
                return;
            }
            
            // Log detalhado de cada empresa
            console.log('\nüè¢ === DETALHES DE CADA EMPRESA ===');
            empresas.forEach((empresa, index) => {
                console.log(`\nüìã Empresa ${index + 1}:`);
                console.log('   üÜî ID Empresa:', empresa.idempresa || 'N/A');
                console.log('   üè∑Ô∏è Nome:', empresa.nome || 'N/A');
                console.log('   üìç Latitude:', empresa.latitude || 'N/A');
                console.log('   üìç Longitude:', empresa.longitude || 'N/A');
                console.log('   üéØ ID Meta:', empresa.idmeta || 'N/A');
                console.log('   üèôÔ∏è Cidade:', empresa.cidade || 'N/A');
                console.log('   üìä Status:', empresa.status || 'N/A');
                console.log('   ‚úÖ Realizado:', empresa.realizado ? 'Sim' : 'N√£o');
                console.log('   üîç Dados completos:', empresa);
            });
            
            // Mostrar empresas em uma lista simples no console
            console.log('\nüìã === LISTA DE EMPRESAS ===');
            empresas.forEach((empresa, index) => {
                const status = empresa.status || 'Ativo';
                const cidade = empresa.cidade || 'N/A';
                const realizado = empresa.realizado ? '‚úÖ' : '‚è≥';
                console.log(`${index + 1}. ${empresa.nome} (${cidade}) - ${status} ${realizado}`);
            });
            
            // N√£o mostrar alerta - apenas logs no console
            console.log('‚úÖ Visualiza√ß√£o conclu√≠da - verifique o console para detalhes');
        }

        function baixarConfigTermo() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/config-termo';
                showAlert('üìã Baixando configura√ß√£o do termo...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const configData = data.config || data.data || data;
                        console.log(`üíæ Salvando no localStorage:`, configData);
                        localStorage.setItem('config_termo', JSON.stringify(configData));
                        localStorage.setItem('config_termo_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('config_termo');
                        console.log(`‚úÖ Dados salvos no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Configura√ß√£o baixada com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar configura√ß√£o', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar configura√ß√£o:', error);
                    showAlert('‚ùå Erro ao baixar configura√ß√£o', 'error');
                    reject();
                });
            });
        }

        function baixarRtsHistorico() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/rts-historico';
                showAlert('üë• Baixando hist√≥rico de RTS...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('rts_historico', JSON.stringify(data.historico));
                        localStorage.setItem('rts_historico_timestamp', Date.now().toString());
                        showAlert('‚úÖ Hist√≥rico de RTS baixado com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar hist√≥rico de RTS', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar hist√≥rico de RTS:', error);
                    showAlert('‚ùå Erro ao baixar hist√≥rico de RTS', 'error');
                    reject();
                });
            });
        }

        function baixarTiposInspecao() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/tipos-inspecao';
                showAlert('üîç Baixando tipos de inspe√ß√£o...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('tipos_inspecao', JSON.stringify(data.tipos));
                        localStorage.setItem('tipos_inspecao_timestamp', Date.now().toString());
                        showAlert('‚úÖ Tipos de inspe√ß√£o baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar tipos de inspe√ß√£o', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar tipos de inspe√ß√£o:', error);
                    showAlert('‚ùå Erro ao baixar tipos de inspe√ß√£o', 'error');
                    reject();
                });
            });
        }

        function baixarInspecoesHistorico() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/inspecoes-historico';
                showAlert('üìä Baixando hist√≥rico de inspe√ß√µes...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('inspecoes_historico', JSON.stringify(data.inspecoes));
                        localStorage.setItem('inspecoes_historico_timestamp', Date.now().toString());
                        showAlert('‚úÖ Hist√≥rico de inspe√ß√µes baixado com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar hist√≥rico de inspe√ß√µes', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar hist√≥rico de inspe√ß√µes:', error);
                    showAlert('‚ùå Erro ao baixar hist√≥rico de inspe√ß√µes', 'error');
                    reject();
                });
            });
        }

        function baixarProtocolos() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/protocolos';
                showAlert('üìÑ Baixando protocolos...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('protocolos', JSON.stringify(data.protocolos));
                        localStorage.setItem('protocolos_timestamp', Date.now().toString());
                        showAlert('‚úÖ Protocolos baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar protocolos', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar protocolos:', error);
                    showAlert('‚ùå Erro ao baixar protocolos', 'error');
                    reject();
                });
            });
        }

        function baixarAfastamentos() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/afastamentos';
                showAlert('üè• Baixando afastamentos...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('afastamentos', JSON.stringify(data.afastamentos));
                        localStorage.setItem('afastamentos_timestamp', Date.now().toString());
                        showAlert('‚úÖ Afastamentos baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar afastamentos', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar afastamentos:', error);
                    showAlert('‚ùå Erro ao baixar afastamentos', 'error');
                    reject();
                });
            });
        }

        function baixarDenuncias() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/denuncias';
                showAlert('üö® Baixando den√∫ncias...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('denuncias', JSON.stringify(data.denuncias));
                        localStorage.setItem('denuncias_timestamp', Date.now().toString());
                        showAlert('‚úÖ Den√∫ncias baixadas com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar den√∫ncias', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar den√∫ncias:', error);
                    showAlert('‚ùå Erro ao baixar den√∫ncias', 'error');
                    reject();
                });
            });
        }

        function baixarOutrosProfissionais() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/outros-profissionais';
                showAlert('üë®‚Äç‚öïÔ∏è Baixando outros profissionais...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('outros_profissionais', JSON.stringify(data.profissionais));
                        localStorage.setItem('outros_profissionais_timestamp', Date.now().toString());
                        showAlert('‚úÖ Outros profissionais baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar outros profissionais', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar outros profissionais:', error);
                    showAlert('‚ùå Erro ao baixar outros profissionais', 'error');
                    reject();
                });
            });
        }

        function baixarOutrosVinculos() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/outros-vinculos';
                showAlert('üîó Baixando outros v√≠nculos...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('outros_vinculos', JSON.stringify(data.vinculos));
                        localStorage.setItem('outros_vinculos_timestamp', Date.now().toString());
                        showAlert('‚úÖ Outros v√≠nculos baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar outros v√≠nculos', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar outros v√≠nculos:', error);
                    showAlert('‚ùå Erro ao baixar outros v√≠nculos', 'error');
                    reject();
                });
            });
        }

        function baixarProcessosEticos() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/processos-eticos';
                showAlert('‚öñÔ∏è Baixando processos √©ticos...', 'success');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    if (data.success) {
                        // Salvar localmente
                        localStorage.setItem('processos_eticos', JSON.stringify(data.processos));
                        localStorage.setItem('processos_eticos_timestamp', Date.now().toString());
                        showAlert('‚úÖ Processos √©ticos baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar processos √©ticos', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar processos √©ticos:', error);
                    showAlert('‚ùå Erro ao baixar processos √©ticos', 'error');
                    reject();
                });
            });
        }

        // Fun√ß√µes de Visualiza√ß√£o (dados locais)
        function visualizarConfigTermo() {
            console.log('üîç Fun√ß√£o visualizarConfigTermo chamada');
            const configData = localStorage.getItem('config_termo');
            console.log('üìã Dados do localStorage:', configData);
            
            if (configData) {
                try {
                    const config = JSON.parse(configData);
                    console.log('üìã Configura√ß√£o parseada:', config);
                    const timestamp = localStorage.getItem('config_termo_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üìã Configura√ß√£o do Termo</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(config)) {
                        html += `<p><strong>Total de campos:</strong> ${config.length}</p>`;
                        html += `<p><strong>Estrutura dos dados:</strong></p>`;
                        html += `<pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;">${JSON.stringify(config, null, 2)}</pre>`;
                    } else if (typeof config === 'object') {
                        // Tentar campos espec√≠ficos se existirem
                        if (config.termo) html += `<p><strong>Termo:</strong> ${config.termo}</p>`;
                        if (config.versao) html += `<p><strong>Vers√£o:</strong> ${config.versao}</p>`;
                        if (config.dataAtualizacao) html += `<p><strong>Data de Atualiza√ß√£o:</strong> ${config.dataAtualizacao}</p>`;
                        if (config.campos && Array.isArray(config.campos)) {
                            html += `<p><strong>Campos:</strong> ${config.campos.join(', ')}</p>`;
                        }
                        html += `<p><strong>Estrutura completa:</strong></p>`;
                        html += `<pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;">${JSON.stringify(config, null, 2)}</pre>`;
                    } else {
                        html += `<p><strong>Valor:</strong> ${config}</p>`;
                    }
                    
                    html += `</div>`;
                    
                    console.log('üìã HTML gerado:', html);
                    console.log('üéØ Elemento content encontrado:', document.getElementById('content'));
                    
                    showAlert('üìã Exibindo configura√ß√£o do termo', 'success');
                    document.getElementById('content').innerHTML = html;
                    
                    console.log('‚úÖ Conte√∫do inserido com sucesso');
                } catch (error) {
                    console.error('‚ùå Erro ao carregar configura√ß√£o:', error);
                    showAlert('‚ùå Erro ao carregar configura√ß√£o', 'error');
                }
            } else {
                console.log('‚ùå Nenhuma configura√ß√£o encontrada no localStorage');
                showAlert('‚ùå Nenhuma configura√ß√£o encontrada. Baixe primeiro!', 'error');
            }
        }

        function visualizarRtsHistorico() {
            const rtsData = localStorage.getItem('rts_historico');
            if (rtsData) {
                try {
                    const historico = JSON.parse(rtsData);
                    const timestamp = localStorage.getItem('rts_historico_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üë• Hist√≥rico de RTS</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de registros:</strong> ${historico.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Profissional</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Especialidade</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    historico.forEach(registro => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${registro.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${registro.profissional}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${registro.especialidade}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${registro.data}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('üë• Exibindo hist√≥rico de RTS', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar hist√≥rico RTS', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum hist√≥rico RTS encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarTiposInspecao() {
            const tiposData = localStorage.getItem('tipos_inspecao');
            if (tiposData) {
                try {
                    const tipos = JSON.parse(tiposData);
                    const timestamp = localStorage.getItem('tipos_inspecao_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üîç Tipos de Inspe√ß√£o</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de tipos:</strong> ${tipos.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Nome</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Descri√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    tipos.forEach(tipo => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${tipo.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${tipo.nome}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${tipo.descricao}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('üîç Exibindo tipos de inspe√ß√£o', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar tipos de inspe√ß√£o', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum tipo de inspe√ß√£o encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarInspecoesHistorico() {
            const inspecoesData = localStorage.getItem('inspecoes_historico');
            if (inspecoesData) {
                try {
                    const inspecoes = JSON.parse(inspecoesData);
                    const timestamp = localStorage.getItem('inspecoes_historico_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üìä Hist√≥rico de Inspe√ß√µes</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de inspe√ß√µes:</strong> ${inspecoes.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Estabelecimento</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Tipo</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Status</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    inspecoes.forEach(inspecao => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${inspecao.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${inspecao.estabelecimento}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${inspecao.tipo}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${inspecao.status}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${inspecao.data}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('üìä Exibindo hist√≥rico de inspe√ß√µes', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar hist√≥rico de inspe√ß√µes', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum hist√≥rico de inspe√ß√µes encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarProtocolos() {
            const protocolosData = localStorage.getItem('protocolos');
            if (protocolosData) {
                try {
                    const protocolos = JSON.parse(protocolosData);
                    const timestamp = localStorage.getItem('protocolos_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üìÑ Protocolos</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de protocolos:</strong> ${protocolos.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Nome</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Vers√£o</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    protocolos.forEach(protocolo => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${protocolo.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${protocolo.nome}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${protocolo.versao}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${protocolo.data}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('üìÑ Exibindo protocolos', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar protocolos', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum protocolo encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarAfastamentos() {
            const afastamentosData = localStorage.getItem('afastamentos');
            if (afastamentosData) {
                try {
                    const afastamentos = JSON.parse(afastamentosData);
                    const timestamp = localStorage.getItem('afastamentos_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üè• Afastamentos</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de afastamentos:</strong> ${afastamentos.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Profissional</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Motivo</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Per√≠odo</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    afastamentos.forEach(afastamento => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${afastamento.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${afastamento.profissional}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${afastamento.motivo}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${afastamento.periodo}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('üè• Exibindo afastamentos', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar afastamentos', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum afastamento encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarDenuncias() {
            const denunciasData = localStorage.getItem('denuncias');
            if (denunciasData) {
                try {
                    const denuncias = JSON.parse(denunciasData);
                    const timestamp = localStorage.getItem('denuncias_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üö® Den√∫ncias</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de den√∫ncias:</strong> ${denuncias.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Estabelecimento</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Denunciante</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Status</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    denuncias.forEach(denuncia => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${denuncia.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${denuncia.estabelecimento}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${denuncia.denunciante}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${denuncia.status}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${denuncia.data}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('üö® Exibindo den√∫ncias', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar den√∫ncias', 'error');
                }
            } else {
                showAlert('‚ùå Nenhuma den√∫ncia encontrada. Baixe primeiro!', 'error');
            }
        }

        function visualizarOutrosProfissionais() {
            const profissionaisData = localStorage.getItem('outros_profissionais');
            if (profissionaisData) {
                try {
                    const profissionais = JSON.parse(profissionaisData);
                    const timestamp = localStorage.getItem('outros_profissionais_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üë®‚Äç‚öïÔ∏è Outros Profissionais</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de profissionais:</strong> ${profissionais.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Nome</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Especialidade</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Registro</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    profissionais.forEach(profissional => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${profissional.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${profissional.nome}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${profissional.especialidade}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${profissional.registro}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('üë®‚Äç‚öïÔ∏è Exibindo outros profissionais', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar outros profissionais', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum outro profissional encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarOutrosVinculos() {
            const vinculosData = localStorage.getItem('outros_vinculos');
            if (vinculosData) {
                try {
                    const vinculos = JSON.parse(vinculosData);
                    const timestamp = localStorage.getItem('outros_vinculos_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üîó Outros V√≠nculos</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de v√≠nculos:</strong> ${vinculos.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Profissional</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Estabelecimento</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Tipo</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    vinculos.forEach(vinculo => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${vinculo.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${vinculo.profissional}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${vinculo.estabelecimento}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${vinculo.tipo}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('üîó Exibindo outros v√≠nculos', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar outros v√≠nculos', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum outro v√≠nculo encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarProcessosEticos() {
            const processosData = localStorage.getItem('processos_eticos');
            if (processosData) {
                try {
                    const processos = JSON.parse(processosData);
                    const timestamp = localStorage.getItem('processos_eticos_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>‚öñÔ∏è Processos √âticos</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                            <p><strong>Total de processos:</strong> ${processos.length}</p>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #f5f5f5;">
                                        <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Profissional</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Processo</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Status</th>
                                        <th style="padding: 10px; border: 1px solid #ddd;">Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    processos.forEach(processo => {
                        html += `
                            <tr>
                                <td style="padding: 10px; border: 1px solid #ddd;">${processo.id}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${processo.profissional}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${processo.processo}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${processo.status}</td>
                                <td style="padding: 10px; border: 1px solid #ddd;">${processo.data}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    showAlert('‚öñÔ∏è Exibindo processos √©ticos', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    showAlert('‚ùå Erro ao carregar processos √©ticos', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum processo √©tico encontrado. Baixe primeiro!', 'error');
            }
        }

        function loadUserData() {
            const user = localStorage.getItem('user');
            const isAuthenticated = localStorage.getItem('isAuthenticated');

            if (!isAuthenticated || !user) {
                window.location.href = '/';
                return;
            }

            try {
                const userData = JSON.parse(user);
                userNameElement.textContent = userData.name;
                


            } catch (error) {
                console.error('Erro ao carregar dados do usu√°rio:', error);
                logout();
            }
        }

        // Carregar dados quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', loadUserData);

        // Verificar autentica√ß√£o a cada 5 minutos
        setInterval(() => {
            const isAuthenticated = localStorage.getItem('isAuthenticated');
            if (!isAuthenticated) {
                logout();
            }
        }, 300000); // 5 minutos
    </script>
</body>
</html> 