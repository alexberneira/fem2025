<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRF App - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
        }

        .header {
            background: #007AFF;
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-name {
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .welcome-section {
            background: linear-gradient(135deg, #5abaa3 0%, #26397f 100%);
            color: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .welcome-title {
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
        }





        .actions-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
            border-left: 4px solid #5abaa3;
        }

        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(90, 186, 163, 0.2);
            border-left-color: #4a9a8a;
        }

        .action-icon {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .action-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 30px;
            border-radius: 12px;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 300px;
            text-align: center;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        }

        .alert.error {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: 1px solid #ff5252;
        }

        .alert.success {
            background: linear-gradient(135deg, #5abaa3, #4caf50);
            color: white;
            border: 1px solid #4caf50;
        }

        .alert.info {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
            border: 1px solid #1976d2;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            to {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        .alert-close {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .alert-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #5abaa3;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .download-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .download-section h3 {
            color: #26397f;
            margin-bottom: 15px;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }





            .actions-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">CRF App</div>
            <div class="user-info">
                <span class="user-name" id="userName">Carregando...</span>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="alert" class="alert">
            <span id="alertMessage"></span>
            <button class="alert-close" onclick="hideAlert()">√ó</button>
        </div>

        <div class="welcome-section">
            <h1 class="welcome-title">Bem-vindo ao CRF App</h1>
            <p class="welcome-subtitle">Sistema de Fiscaliza√ß√£o e Monitoramento</p>
        </div>



        <!-- Se√ß√£o de Downloads Principais -->
        <div class="download-section">
            <h3>üì• Downloads de Dados</h3>
            
            <!-- Listar Empresas (linha inteira) -->
            <div class="actions-row">
                <div class="action-card" onclick="window.location.href='/empresas'">
                    <div class="action-icon">üìã</div>
                    <div class="action-title">Listar Empresas</div>
                    <div class="action-description">Visualizar empresas cadastradas</div>
                </div>
            </div>

            <!-- Bot√£o Baixar Tudo (linha inteira) -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarTudo()" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; font-weight: bold;">
                    <div class="action-icon">üöÄ</div>
                    <div class="action-title">BAIXAR TUDO</div>
                    <div class="action-description">Baixar todos os dados dispon√≠veis</div>
                </div>
            </div>

            <!-- Baixar Empresas e Ver Empresas -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarEmpresas()">
                    <div class="action-icon">üì•</div>
                    <div class="action-title">Baixar Empresas</div>
                    <div class="action-description">Baixar empresas do servidor</div>
                </div>
                <div class="action-card" onclick="visualizarEmpresasLocais()" style="background-color: #ff6b6b; color: white;">
                    <div class="action-icon">üëÅÔ∏è</div>
                    <div class="action-title">Ver Empresas</div>
                    <div class="action-description">Visualizar dados locais</div>
                </div>
            </div>



            <!-- Configura√ß√£o do Termo -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarConfigTermo()">
                    <div class="action-icon">üìã</div>
                    <div class="action-title">Baixar Configura√ß√£o</div>
                    <div class="action-description">Configura√ß√£o do termo</div>
                </div>
                <div class="action-card" onclick="visualizarConfigTermo()" style="background-color: #4ecdc4; color: white;">
                    <div class="action-icon">üìã</div>
                    <div class="action-title">Ver Configura√ß√£o</div>
                    <div class="action-description">Visualizar configura√ß√£o</div>
                </div>
            </div>

            <!-- Hist√≥rico de RTS -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarRtsHistorico()">
                    <div class="action-icon">üë•</div>
                    <div class="action-title">Baixar RTS</div>
                    <div class="action-description">Hist√≥rico de RTS</div>
                </div>
                <div class="action-card" onclick="visualizarRtsHistorico()" style="background-color: #ffa726; color: white;">
                    <div class="action-icon">üë•</div>
                    <div class="action-title">Ver RTS</div>
                    <div class="action-description">Visualizar hist√≥rico RTS</div>
                </div>
            </div>

            <!-- Hist√≥rico de RTs -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarHistoricoRts()">
                    <div class="action-icon">üìä</div>
                    <div class="action-title">Baixar Hist√≥rico RTs</div>
                    <div class="action-description">Hist√≥rico completo de RTs</div>
                </div>
                <div class="action-card" onclick="visualizarHistoricoRts()" style="background-color: #28a745; color: white;">
                    <div class="action-icon">üìä</div>
                    <div class="action-title">Ver Hist√≥rico RTs</div>
                    <div class="action-description">Visualizar hist√≥rico RTs</div>
                </div>
            </div>

            <!-- Tipos de Inspe√ß√£o -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarTiposInspecao()">
                    <div class="action-icon">üîç</div>
                    <div class="action-title">Baixar Tipos</div>
                    <div class="action-description">Tipos de inspe√ß√£o</div>
                </div>
                <div class="action-card" onclick="visualizarTiposInspecao()" style="background-color: #9c27b0; color: white;">
                    <div class="action-icon">üîç</div>
                    <div class="action-title">Ver Tipos</div>
                    <div class="action-description">Visualizar tipos</div>
                </div>
            </div>

            <!-- Hist√≥rico de Inspe√ß√µes -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarInspecoesHistorico()">
                    <div class="action-icon">üìä</div>
                    <div class="action-title">Baixar Inspe√ß√µes</div>
                    <div class="action-description">Hist√≥rico de inspe√ß√µes</div>
                </div>
                <div class="action-card" onclick="visualizarInspecoesHistorico()" style="background-color: #e91e63; color: white;">
                    <div class="action-icon">üìä</div>
                    <div class="action-title">Ver Inspe√ß√µes</div>
                    <div class="action-description">Visualizar inspe√ß√µes</div>
                </div>
            </div>

            <!-- Protocolos -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarProtocolos()">
                    <div class="action-icon">üìÑ</div>
                    <div class="action-title">Baixar Protocolos</div>
                    <div class="action-description">Protocolos dispon√≠veis</div>
                </div>
                <div class="action-card" onclick="visualizarProtocolos()" style="background-color: #795548; color: white;">
                    <div class="action-icon">üìÑ</div>
                    <div class="action-title">Ver Protocolos</div>
                    <div class="action-description">Visualizar protocolos</div>
                </div>
            </div>

            <!-- Afastamentos -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarAfastamentos()">
                    <div class="action-icon">üè•</div>
                    <div class="action-title">Baixar Afastamentos</div>
                    <div class="action-description">Dados de afastamentos</div>
                </div>
                <div class="action-card" onclick="visualizarAfastamentos()" style="background-color: #607d8b; color: white;">
                    <div class="action-icon">üè•</div>
                    <div class="action-title">Ver Afastamentos</div>
                    <div class="action-description">Visualizar afastamentos</div>
                </div>
            </div>

            <!-- Den√∫ncias -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarDenuncias()">
                    <div class="action-icon">üö®</div>
                    <div class="action-title">Baixar Den√∫ncias</div>
                    <div class="action-description">Hist√≥rico de den√∫ncias</div>
                </div>
                <div class="action-card" onclick="visualizarDenuncias()" style="background-color: #f44336; color: white;">
                    <div class="action-icon">üö®</div>
                    <div class="action-title">Ver Den√∫ncias</div>
                    <div class="action-description">Visualizar den√∫ncias</div>
                </div>
            </div>

            <!-- Outros Profissionais -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarOutrosProfissionais()">
                    <div class="action-icon">üë®‚Äç‚öïÔ∏è</div>
                    <div class="action-title">Baixar Outros Profissionais</div>
                    <div class="action-description">Dados de outros profissionais</div>
                </div>
                <div class="action-card" onclick="visualizarOutrosProfissionais()" style="background-color: #2196f3; color: white;">
                    <div class="action-icon">üë®‚Äç‚öïÔ∏è</div>
                    <div class="action-title">Ver Outros Profissionais</div>
                    <div class="action-description">Visualizar profissionais</div>
                </div>
            </div>

            <!-- Outros V√≠nculos -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarOutrosVinculos()">
                    <div class="action-icon">üîó</div>
                    <div class="action-title">Baixar Outros V√≠nculos</div>
                    <div class="action-description">V√≠nculos profissionais</div>
                </div>
                <div class="action-card" onclick="visualizarOutrosVinculos()" style="background-color: #ff9800; color: white;">
                    <div class="action-icon">üîó</div>
                    <div class="action-title">Ver Outros V√≠nculos</div>
                    <div class="action-description">Visualizar v√≠nculos</div>
                </div>
            </div>

            <!-- Processos √âticos -->
            <div class="actions-row">
                <div class="action-card" onclick="baixarProcessosEticos()">
                    <div class="action-icon">‚öñÔ∏è</div>
                    <div class="action-title">Baixar Processos √âticos</div>
                    <div class="action-description">Processos √©ticos</div>
                </div>
                <div class="action-card" onclick="visualizarProcessosEticos()" style="background-color: #673ab7; color: white;">
                    <div class="action-icon">‚öñÔ∏è</div>
                    <div class="action-title">Ver Processos √âticos</div>
                    <div class="action-description">Visualizar processos</div>
                </div>
            </div>
        </div>

        <!-- √Årea de Conte√∫do para Visualiza√ß√£o -->
        <div id="content"></div>


    </div>

    <script>
        const alertDiv = document.getElementById('alert');
        const userNameElement = document.getElementById('userName');

        function showAlert(message, type, persistent = false) {
            const alertMessage = document.getElementById('alertMessage');
            alertMessage.textContent = message;
            alertDiv.className = `alert ${type}`;
            alertDiv.style.display = 'block';
            
            // Se n√£o for persistente, aplicar auto-hide
            if (!persistent) {
                // Auto-hide ap√≥s 3 segundos para mensagens de sucesso e info
                if (type === 'success' || type === 'info') {
                    setTimeout(() => {
                        hideAlert();
                    }, 3000);
                }
                
                // Auto-hide ap√≥s 5 segundos para mensagens de erro
                if (type === 'error') {
                    setTimeout(() => {
                        hideAlert();
                    }, 5000);
                }
            }
        }

        // Fun√ß√£o espec√≠fica para mensagens de download que permanecem at√© conclus√£o
        function showDownloadAlert(message, type) {
            showAlert(message, type, true); // persistente = true
        }

        function hideAlert() {
            alertDiv.style.animation = 'slideOut 0.3s ease-in';
            setTimeout(() => {
            alertDiv.style.display = 'none';
                alertDiv.style.animation = '';
            }, 300);
        }

        function logout() {
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('user');
            window.location.href = '/';
        }



        // Fun√ß√µes de Download (usando APIs reais)
        function baixarTudo() {
            showAlert('üöÄ Iniciando download completo de todos os dados...', 'success');
            
            // Executar todos os downloads sequencialmente
            const downloads = [
                { name: 'Empresas', func: baixarEmpresas },
                { name: 'Configura√ß√£o', func: baixarConfigTermo },
                { name: 'RTS', func: baixarRtsHistorico },
                { name: 'Hist√≥rico RTs', func: baixarHistoricoRts },
                { name: 'Tipos de Inspe√ß√£o', func: baixarTiposInspecao },
                { name: 'Inspe√ß√µes', func: baixarInspecoesHistorico },
                { name: 'Protocolos', func: baixarProtocolos },
                { name: 'Afastamentos', func: baixarAfastamentos },
                { name: 'Den√∫ncias', func: baixarDenuncias },
                { name: 'Outros Profissionais', func: baixarOutrosProfissionais },
                { name: 'Outros V√≠nculos', func: baixarOutrosVinculos },
                { name: 'Processos √âticos', func: baixarProcessosEticos }
            ];

            let completed = 0;
            let successCount = 0;
            let errorCount = 0;

            // Fun√ß√£o para executar downloads sequencialmente
            async function executarDownloads() {
                for (let i = 0; i < downloads.length; i++) {
                    const download = downloads[i];
                    try {
                        console.log(`üîÑ Executando: ${download.name} (${i + 1}/${downloads.length})`);
                        showDownloadAlert(`üîÑ Baixando ${download.name}... (${i + 1}/${downloads.length})`, 'info');
                        
                        await download.func();
                        
                        successCount++;
                        completed++;
                        console.log(`‚úÖ ${download.name} conclu√≠do com sucesso!`);
                        showAlert(`‚úÖ ${download.name} baixado com sucesso! (${completed}/${downloads.length})`, 'success');
                        
                        // Aguardar 1 segundo antes do pr√≥ximo download
                        if (i < downloads.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                        
                    } catch (error) {
                        errorCount++;
                        completed++;
                        console.error(`‚ùå Erro ao baixar ${download.name}:`, error);
                        showAlert(`‚ùå Erro ao baixar ${download.name} (${completed}/${downloads.length})`, 'error');
                        
                        // Aguardar 1 segundo antes do pr√≥ximo download
                        if (i < downloads.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                    }
                }
                
                // Resumo final
                if (errorCount === 0) {
                    showAlert(`üéâ Download completo finalizado com sucesso! Todos os ${successCount} downloads foram conclu√≠dos.`, 'success');
                } else {
                    showAlert(`‚ö†Ô∏è Download completo finalizado! ${successCount} sucessos, ${errorCount} erros.`, 'warning');
                }
            }

            // Iniciar execu√ß√£o sequencial
            executarDownloads();
        }

        function baixarEmpresas() {
            return new Promise((resolve, reject) => {
                showDownloadAlert('üì• Baixando empresas do servidor...', 'info');
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }
                
                fetch('/api/empresas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('üì• Resposta da API empresas:', data);
                    
                    if (data.msg === "Nenhum dado Encontrado") {
                        showAlert('‚ÑπÔ∏è Nenhuma empresa encontrada para este usu√°rio', 'success');
                        localStorage.setItem('empresas', JSON.stringify([]));
                        localStorage.setItem('empresas_timestamp', Date.now().toString());
                        resolve();
                    } else if (data.msg === "sucesso" && data[0]) {
                        // A API retorna: {"msg":"sucesso","0":{"idempresa":"517798",...},"1":{"idempresa":"...",...}}
                        const empresas = [];
                        Object.keys(data).forEach(key => {
                            if (key !== 'msg' && data[key]) {
                                // Adicionar campo 'realizado' para controle de inspe√ß√£o
                                const empresa = {
                                    ...data[key],
                                    realizado: false // Por padr√£o, inspe√ß√£o n√£o foi realizada
                                };
                                empresas.push(empresa);
                            }
                        });
                        
                        localStorage.setItem('empresas', JSON.stringify(empresas));
                        localStorage.setItem('empresas_timestamp', Date.now().toString());
                        showAlert(`‚úÖ ${empresas.length} empresas baixadas com sucesso!`, 'success');
                        resolve();
                    } else if (data.empresas || Array.isArray(data)) {
                        const empresas = data.empresas || data;
                        localStorage.setItem('empresas', JSON.stringify(empresas));
                        localStorage.setItem('empresas_timestamp', Date.now().toString());
                        showAlert(`‚úÖ ${empresas.length} empresas baixadas com sucesso!`, 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Formato de resposta inesperado da API', 'error');
                        console.log('Resposta inesperada:', data);
                        reject(new Error('Formato de resposta inesperado da API'));
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar empresas:', error);
                    showAlert(`‚ùå Erro ao baixar empresas: ${error.message}`, 'error');
                    reject(error);
                });
            });
        }

        function sincronizarDados() {
            showAlert('üîÑ Sincronizando dados com o servidor...', 'success');
            
            fetch('/api/sincronizar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('‚úÖ Sincroniza√ß√£o conclu√≠da com sucesso!', 'success');
                } else {
                    showAlert('‚ùå Erro na sincroniza√ß√£o', 'error');
                }
            })
            .catch(error => {
                console.error('Erro na sincroniza√ß√£o:', error);
                showAlert('‚ùå Erro ao sincronizar dados', 'error');
            });
        }

        function listarEmpresas() {
            console.log('üìã Listando empresas do banco local');
            
            // Buscar dados diretamente do localStorage (banco local)
            const empresas = JSON.parse(localStorage.getItem('empresas') || '[]');
            const timestamp = localStorage.getItem('empresas_timestamp');
            
            if (empresas.length === 0) {
                console.log('‚ùå Banco local vazio - nenhuma empresa encontrada');
                showAlert('‚ÑπÔ∏è Nenhuma empresa encontrada no banco local. Use "BAIXAR EMPRESAS" primeiro.', 'info');
                return;
            }
            
            // Criar lista formatada para exibi√ß√£o
            let empresasList = 'üìã **LISTA DE EMPRESAS CADASTRADAS**\n\n';
            empresas.forEach((empresa, index) => {
                const status = empresa.status || 'Ativo';
                const cidade = empresa.cidade || 'N/A';
                const realizado = empresa.realizado ? '‚úÖ Realizada' : '‚è≥ Pendente';
                const coordenadas = empresa.latitude && empresa.longitude ? 
                    `üìç ${empresa.latitude}, ${empresa.longitude}` : 'üìç Coordenadas n√£o definidas';
                
                empresasList += `**${index + 1}. ${empresa.nome}**\n`;
                empresasList += `   üÜî ID: ${empresa.idempresa || 'N/A'}\n`;
                empresasList += `   üéØ Meta: ${empresa.idmeta || 'N/A'}\n`;
                empresasList += `   üèôÔ∏è Cidade: ${cidade}\n`;
                empresasList += `   üìä Status: ${status}\n`;
                empresasList += `   üîç Inspe√ß√£o: ${realizado}\n`;
                empresasList += `   ${coordenadas}\n\n`;
            });
            
            // Mostrar lista formatada
            showAlert(empresasList, 'success');
            
            // Log detalhado no console
            console.log('üìä === DADOS COMPLETOS DO BANCO LOCAL ===');
            console.log('üïí Timestamp de download:', timestamp ? new Date(parseInt(timestamp)).toLocaleString() : 'N/A');
            console.log('üìà Total de empresas:', empresas.length);
            console.log('üóÑÔ∏è Dados brutos do localStorage:', empresas);
        }



        function visualizarEmpresasLocais() {
            console.log('üëÅÔ∏è Visualizando empresas locais');
            
            // Buscar dados diretamente do localStorage (banco local)
            const empresas = JSON.parse(localStorage.getItem('empresas') || '[]');
            const timestamp = localStorage.getItem('empresas_timestamp');
            
            if (empresas.length === 0) {
                showAlert('‚ÑπÔ∏è Nenhuma empresa encontrada no banco local', 'info');
                return;
            }
            
            const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
            
            let html = `
                <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h3>üè¢ Empresas Locais</h3>
                    <p><strong>Baixado em:</strong> ${data}</p>
                    <p><strong>Total de empresas:</strong> ${empresas.length}</p>
                    
                    <div style="margin-top: 20px;">
                        <h4>üìã Lista de Empresas:</h4>
            `;
            
            empresas.forEach((empresa, index) => {
                const status = empresa.status || 'Ativo';
                const cidade = empresa.cidade || 'N/A';
                const realizado = empresa.realizado ? '‚úÖ Realizada' : '‚è≥ Pendente';
                const coordenadas = empresa.latitude && empresa.longitude ? 
                    `üìç ${empresa.latitude}, ${empresa.longitude}` : 'üìç Coordenadas n√£o definidas';
                
                html += `
                    <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #5abaa3;">
                        <h5 style="margin: 0 0 10px 0; color: #26397f;">${index + 1}. ${empresa.nome || empresa.razao || 'Nome n√£o informado'}</h5>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 14px;">
                            <div><strong>üÜî ID:</strong> ${empresa.idempresa || 'N/A'}</div>
                            <div><strong>üéØ Meta:</strong> ${empresa.idmeta || 'N/A'}</div>
                            <div><strong>üèôÔ∏è Cidade:</strong> ${cidade}</div>
                            <div><strong>üìä Status:</strong> ${status}</div>
                            <div><strong>üîç Inspe√ß√£o:</strong> ${realizado}</div>
                            <div><strong>${coordenadas}</strong></div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button onclick="limparConteudo()" style="background: #e9e674; color: #26397f; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            üóëÔ∏è Limpar Visualiza√ß√£o
                        </button>
                    </div>
                </div>
            `;
            
            showAlert('üè¢ Exibindo empresas locais', 'success');
            document.getElementById('content').innerHTML = html;
            
            // Log no console para debug
            console.log('‚úÖ Conte√∫do inserido na tela:', html);
        }

        function baixarConfigTermo() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/config-termo';
                showDownloadAlert('üìã Baixando configura√ß√£o do termo...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const configData = data.config || data.data || data;
                        console.log(`üíæ Salvando no localStorage:`, configData);
                        localStorage.setItem('config_termo', JSON.stringify(configData));
                        localStorage.setItem('config_termo_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('config_termo');
                        console.log(`‚úÖ Dados salvos no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Configura√ß√£o baixada com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar configura√ß√£o', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar configura√ß√£o:', error);
                    showAlert('‚ùå Erro ao baixar configura√ß√£o', 'error');
                    reject();
                });
            });
        }

        function baixarRtsHistorico() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/rts-historico';
                showDownloadAlert('üë• Baixando hist√≥rico de RTS...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const rtsData = data.historico || data.data || data;
                        console.log(`üíæ Salvando RTS no localStorage:`, rtsData);
                        localStorage.setItem('rts_historico', JSON.stringify(rtsData));
                        localStorage.setItem('rts_historico_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('rts_historico');
                        console.log(`‚úÖ RTS salvo no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Hist√≥rico de RTS baixado com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar hist√≥rico de RTS', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar hist√≥rico de RTS:', error);
                    showAlert('‚ùå Erro ao baixar hist√≥rico de RTS', 'error');
                    reject();
                });
            });
        }

        function baixarTiposInspecao() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/tipos-inspecao';
                showDownloadAlert('üîç Baixando tipos de inspe√ß√£o...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const tiposData = data.tipos || data.data || data;
                        console.log(`üíæ Salvando tipos de inspe√ß√£o no localStorage:`, tiposData);
                        localStorage.setItem('tipos_inspecao', JSON.stringify(tiposData));
                        localStorage.setItem('tipos_inspecao_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('tipos_inspecao');
                        console.log(`‚úÖ Tipos de inspe√ß√£o salvos no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Tipos de inspe√ß√£o baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar tipos de inspe√ß√£o', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar tipos de inspe√ß√£o:', error);
                    showAlert('‚ùå Erro ao baixar tipos de inspe√ß√£o', 'error');
                    reject();
                });
            });
        }

        function baixarInspecoesHistorico() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/inspecoes-historico';
                showDownloadAlert('üìä Baixando hist√≥rico de inspe√ß√µes...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const inspecoesData = data.inspecoes || data.data || data;
                        console.log(`üíæ Salvando inspe√ß√µes no localStorage:`, inspecoesData);
                        localStorage.setItem('inspecoes_historico', JSON.stringify(inspecoesData));
                        localStorage.setItem('inspecoes_historico_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('inspecoes_historico');
                        console.log(`‚úÖ Inspe√ß√µes salvas no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Hist√≥rico de inspe√ß√µes baixado com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar hist√≥rico de inspe√ß√µes', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar hist√≥rico de inspe√ß√µes:', error);
                    showAlert('‚ùå Erro ao baixar hist√≥rico de inspe√ß√µes', 'error');
                    reject();
                });
            });
        }

        function baixarProtocolos() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/protocolos';
                showDownloadAlert('üìÑ Baixando protocolos...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const protocolosData = data.protocolos || data.data || data;
                        console.log(`üíæ Salvando protocolos no localStorage:`, protocolosData);
                        localStorage.setItem('protocolos', JSON.stringify(protocolosData));
                        localStorage.setItem('protocolos_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('protocolos');
                        console.log(`‚úÖ Protocolos salvos no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Protocolos baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar protocolos', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar protocolos:', error);
                    showAlert('‚ùå Erro ao baixar protocolos', 'error');
                    reject();
                });
            });
        }

        function baixarAfastamentos() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/afastamentos';
                showDownloadAlert('üè• Baixando afastamentos...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const afastamentosData = data.afastamentos || data.data || data;
                        console.log(`üíæ Salvando afastamentos no localStorage:`, afastamentosData);
                        localStorage.setItem('afastamentos', JSON.stringify(afastamentosData));
                        localStorage.setItem('afastamentos_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('afastamentos');
                        console.log(`‚úÖ Afastamentos salvos no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Afastamentos baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar afastamentos', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar afastamentos:', error);
                    showAlert('‚ùå Erro ao baixar afastamentos', 'error');
                    reject();
                });
            });
        }

        function baixarHistoricoRts() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/rts-historico';
                showDownloadAlert('üìä Baixando hist√≥rico de RTs...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const historicoRtsData = data.historico || data.data || data;
                        console.log(`üíæ Salvando hist√≥rico de RTs no localStorage:`, historicoRtsData);
                        localStorage.setItem('historico_rts', JSON.stringify(historicoRtsData));
                        localStorage.setItem('historico_rts_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('historico_rts');
                        console.log(`‚úÖ Hist√≥rico de RTs salvo no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Hist√≥rico de RTs baixado com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar hist√≥rico de RTs', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar hist√≥rico de RTs:', error);
                    showAlert('‚ùå Erro ao baixar hist√≥rico de RTs', 'error');
                    reject();
                });
            });
        }

        function visualizarHistoricoRts() {
            const historicoRtsData = localStorage.getItem('historico_rts');
            
            if (!historicoRtsData) {
                showAlert('‚ùå Nenhum hist√≥rico de RTs encontrado. Use "BAIXAR HIST√ìRICO RTS" primeiro.', 'error');
                return;
            }

            try {
                const historico = JSON.parse(historicoRtsData);
                console.log('üìä Hist√≥rico de RTs carregado:', historico);
                
                // Criar modal para visualizar os dados
                let modalContent = `
                    <div class="modal-header">
                        <h2>üìä Hist√≥rico de RTs</h2>
                        <span class="close" onclick="closeModal()">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div class="data-info">
                            <p><strong>Total de registros:</strong> ${Array.isArray(historico) ? historico.length : Object.keys(historico).filter(key => !isNaN(key)).length}</p>
                            <p><strong>√öltima atualiza√ß√£o:</strong> ${new Date(parseInt(localStorage.getItem('historico_rts_timestamp'))).toLocaleString('pt-BR')}</p>
                        </div>
                        <div class="data-preview">
                            <h3>Pr√©via dos dados:</h3>
                            <pre>${JSON.stringify(historico, null, 2)}</pre>
                        </div>
                    </div>
                `;
                
                showModal(modalContent);
                
            } catch (error) {
                console.error('‚ùå Erro ao visualizar hist√≥rico de RTs:', error);
                showAlert('‚ùå Erro ao visualizar hist√≥rico de RTs', 'error');
            }
        }

        function baixarDenuncias() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/denuncias';
                showDownloadAlert('üö® Baixando den√∫ncias...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const denunciasData = data.denuncias || data.data || data;
                        console.log(`üíæ Salvando den√∫ncias no localStorage:`, denunciasData);
                        localStorage.setItem('denuncias', JSON.stringify(denunciasData));
                        localStorage.setItem('denuncias_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('denuncias');
                        console.log(`‚úÖ Den√∫ncias salvas no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Den√∫ncias baixadas com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar den√∫ncias', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar den√∫ncias:', error);
                    showAlert('‚ùå Erro ao baixar den√∫ncias', 'error');
                    reject();
                });
            });
        }

        function baixarOutrosProfissionais() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/outros-profissionais';
                showDownloadAlert('üë®‚Äç‚öïÔ∏è Baixando outros profissionais...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const profissionaisData = data.profissionais || data.data || data;
                        console.log(`üíæ Salvando outros profissionais no localStorage:`, profissionaisData);
                        localStorage.setItem('outros_profissionais', JSON.stringify(profissionaisData));
                        localStorage.setItem('outros_profissionais_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('outros_profissionais');
                        console.log(`‚úÖ Outros profissionais salvos no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Outros profissionais baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar outros profissionais', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar outros profissionais:', error);
                    showAlert('‚ùå Erro ao baixar outros profissionais', 'error');
                    reject();
                });
            });
        }

        function baixarOutrosVinculos() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/outros-vinculos';
                showDownloadAlert('üîó Baixando outros v√≠nculos...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const vinculosData = data.vinculos || data.data || data;
                        console.log(`üíæ Salvando outros v√≠nculos no localStorage:`, vinculosData);
                        localStorage.setItem('outros_vinculos', JSON.stringify(vinculosData));
                        localStorage.setItem('outros_vinculos_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('outros_vinculos');
                        console.log(`‚úÖ Outros v√≠nculos salvos no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Outros v√≠nculos baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar outros v√≠nculos', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar outros v√≠nculos:', error);
                    showAlert('‚ùå Erro ao baixar outros v√≠nculos', 'error');
                    reject();
                });
            });
        }

        function baixarProcessosEticos() {
            return new Promise((resolve, reject) => {
                const endpoint = '/api/processos-eticos';
                showDownloadAlert('‚öñÔ∏è Baixando processos √©ticos...', 'info');
                
                console.log(`üåê Acessando endpoint: ${endpoint}`);
                
                // Pegar o ID do usu√°rio do localStorage ou usar um valor padr√£o
                const user = localStorage.getItem('user');
                let iduser = '1'; // valor padr√£o
                
                if (user) {
                    try {
                        const userData = JSON.parse(user);
                        iduser = userData.id || '1';
                    } catch (error) {
                        console.log('Usando ID padr√£o para usu√°rio');
                    }
                }

                fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `iduser=${iduser}`
                })
                .then(response => {
                    console.log(`üì° Status da resposta: ${response.status} ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    console.log(`üì• Retorno do servidor:`, data);
                    
                    // Verificar se h√° dados v√°lidos (pode ser data.success, data.msg, ou diretamente data)
                    if (data && (data.success || data.msg === 'sucesso' || data.length > 0 || Object.keys(data).length > 0)) {
                        // Salvar localmente - tentar diferentes estruturas poss√≠veis
                        const processosData = data.processos || data.data || data;
                        console.log(`üíæ Salvando processos √©ticos no localStorage:`, processosData);
                        localStorage.setItem('processos_eticos', JSON.stringify(processosData));
                        localStorage.setItem('processos_eticos_timestamp', Date.now().toString());
                        
                        // Verificar se foi salvo
                        const savedData = localStorage.getItem('processos_eticos');
                        console.log(`‚úÖ Processos √©ticos salvos no localStorage:`, savedData);
                        
                        showAlert('‚úÖ Processos √©ticos baixados com sucesso!', 'success');
                        resolve();
                    } else {
                        showAlert('‚ùå Erro ao baixar processos √©ticos', 'error');
                        reject();
                    }
                })
                .catch(error => {
                    console.error('‚ùå Erro ao baixar processos √©ticos:', error);
                    showAlert('‚ùå Erro ao baixar processos √©ticos', 'error');
                    reject();
                });
            });
        }

        // Fun√ß√µes de Visualiza√ß√£o (dados locais)
        function visualizarConfigTermo() {
            const configData = localStorage.getItem('config_termo');
            
            if (configData) {
                try {
                    const config = JSON.parse(configData);
                    const timestamp = localStorage.getItem('config_termo_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>üìã Configura√ß√£o do Termo</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(config)) {
                        html += `<p><strong>Total de campos:</strong> ${config.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem JSON completo
                        if (config.length > 0) {
                            html += `<p><strong>Primeiros campos:</strong></p>`;
                            config.slice(0, 5).forEach((campo, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                if (typeof campo === 'object') {
                                    Object.entries(campo).forEach(([chave, valor]) => {
                                        if (valor && valor !== 'null' && valor !== '') {
                                            html += `<strong>${chave}:</strong> ${valor}<br>`;
                                        }
                                    });
                                } else {
                                    html += `<strong>Campo ${index + 1}:</strong> ${campo}`;
                                }
                                html += `</div>`;
                            });
                            
                            if (config.length > 5) {
                                html += `<p><em>... e mais ${config.length - 5} campos</em></p>`;
                            }
                        }
                    } else if (typeof config === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(config).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${config}</p>`;
                    }
                    
                    html += `
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="limparConteudo()" style="background: #e9e674; color: #26397f; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                üóëÔ∏è Limpar Visualiza√ß√£o
                            </button>
                        </div>
                    </div>
                    `;
                    
                    showAlert('üìã Exibindo configura√ß√£o do termo', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar configura√ß√£o:', error);
                    showAlert('‚ùå Erro ao carregar configura√ß√£o', 'error');
                }
            } else {
                showAlert('‚ùå Nenhuma configura√ß√£o encontrada. Baixe primeiro!', 'error');
            }
        }

        function visualizarRtsHistorico() {
            const rtsData = localStorage.getItem('rts_historico');
            
            if (rtsData) {
                try {
                    const historico = JSON.parse(rtsData);
                    const timestamp = localStorage.getItem('rts_historico_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>üë• Hist√≥rico de RTS</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(historico)) {
                        html += `<p><strong>Total de registros:</strong> ${historico.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem JSON completo
                        if (historico.length > 0) {
                            html += `<p><strong>Primeiros registros:</strong></p>`;
                            historico.slice(0, 5).forEach((item, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(item).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (historico.length > 5) {
                                html += `<p><em>... e mais ${historico.length - 5} registros</em></p>`;
                            }
                        }
                    } else if (typeof historico === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(historico).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${historico}</p>`;
                    }
                    
                    html += `
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="limparConteudo()" style="background: #e9e674; color: #26397f; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                üóëÔ∏è Limpar Visualiza√ß√£o
                            </button>
                        </div>
                    </div>
                    `;
                    
                    showAlert('üë• Exibindo hist√≥rico de RTS', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar hist√≥rico RTS:', error);
                    showAlert('‚ùå Erro ao carregar hist√≥rico RTS', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum hist√≥rico RTS encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarTiposInspecao() {
            const tiposData = localStorage.getItem('tipos_inspecao');
            
            if (tiposData) {
                try {
                    const tipos = JSON.parse(tiposData);
                    const timestamp = localStorage.getItem('tipos_inspecao_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>üîç Tipos de Inspe√ß√£o</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(tipos)) {
                        html += `<p><strong>Total de tipos:</strong> ${tipos.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem tabela complexa
                        if (tipos.length > 0) {
                            html += `<p><strong>Tipos dispon√≠veis:</strong></p>`;
                            tipos.slice(0, 5).forEach((tipo, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(tipo).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (tipos.length > 5) {
                                html += `<p><em>... e mais ${tipos.length - 5} tipos</em></p>`;
                            }
                        }
                    } else if (typeof tipos === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(tipos).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${tipos}</p>`;
                    }
                    
                    html += `
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="limparConteudo()" style="background: #e9e674; color: #26397f; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                üóëÔ∏è Limpar Visualiza√ß√£o
                            </button>
                        </div>
                    </div>
                    `;
                    
                    showAlert('üîç Exibindo tipos de inspe√ß√£o', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar tipos de inspe√ß√£o:', error);
                    showAlert('‚ùå Erro ao carregar tipos de inspe√ß√£o', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum tipo de inspe√ß√£o encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarInspecoesHistorico() {
            const inspecoesData = localStorage.getItem('inspecoes_historico');
            
            if (inspecoesData) {
                try {
                    const inspecoes = JSON.parse(inspecoesData);
                    const timestamp = localStorage.getItem('inspecoes_historico_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>üìä Hist√≥rico de Inspe√ß√µes</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(inspecoes)) {
                        html += `<p><strong>Total de inspe√ß√µes:</strong> ${inspecoes.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem tabela complexa
                        if (inspecoes.length > 0) {
                            html += `<p><strong>Primeiras inspe√ß√µes:</strong></p>`;
                            inspecoes.slice(0, 5).forEach((inspecao, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(inspecao).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (inspecoes.length > 5) {
                                html += `<p><em>... e mais ${inspecoes.length - 5} inspe√ß√µes</em></p>`;
                            }
                        }
                    } else if (typeof inspecoes === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(inspecoes).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${inspecoes}</p>`;
                    }
                    
                    html += `
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="limparConteudo()" style="background: #e9e674; color: #26397f; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                üóëÔ∏è Limpar Visualiza√ß√£o
                            </button>
                        </div>
                    </div>
                    `;
                    
                    showAlert('üìä Exibindo hist√≥rico de inspe√ß√µes', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar hist√≥rico de inspe√ß√µes:', error);
                    showAlert('‚ùå Erro ao carregar hist√≥rico de inspe√ß√µes', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum hist√≥rico de inspe√ß√µes encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarProtocolos() {
            const protocolosData = localStorage.getItem('protocolos');
            
            if (protocolosData) {
                try {
                    const protocolos = JSON.parse(protocolosData);
                    const timestamp = localStorage.getItem('protocolos_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>üìÑ Protocolos</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(protocolos)) {
                        html += `<p><strong>Total de protocolos:</strong> ${protocolos.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem tabela complexa
                        if (protocolos.length > 0) {
                            html += `<p><strong>Primeiros protocolos:</strong></p>`;
                            protocolos.slice(0, 5).forEach((protocolo, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(protocolo).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (protocolos.length > 5) {
                                html += `<p><em>... e mais ${protocolos.length - 5} protocolos</em></p>`;
                            }
                        }
                    } else if (typeof protocolos === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(protocolos).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${protocolos}</p>`;
                    }
                    
                    html += `
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="limparConteudo()" style="background: #e9e674; color: #26397f; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                üóëÔ∏è Limpar Visualiza√ß√£o
                            </button>
                        </div>
                    </div>
                    `;
                    
                    showAlert('üìÑ Exibindo protocolos', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar protocolos:', error);
                    showAlert('‚ùå Erro ao carregar protocolos', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum protocolo encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarAfastamentos() {
            const afastamentosData = localStorage.getItem('afastamentos');
            
            if (afastamentosData) {
                try {
                    const afastamentos = JSON.parse(afastamentosData);
                    const timestamp = localStorage.getItem('afastamentos_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>üö´ Afastamentos</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(afastamentos)) {
                        html += `<p><strong>Total de afastamentos:</strong> ${afastamentos.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem tabela complexa
                        if (afastamentos.length > 0) {
                            html += `<p><strong>Primeiros afastamentos:</strong></p>`;
                            afastamentos.slice(0, 5).forEach((afastamento, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(afastamento).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (afastamentos.length > 5) {
                                html += `<p><em>... e mais ${afastamentos.length - 5} afastamentos</em></p>`;
                            }
                        }
                    } else if (typeof afastamentos === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(afastamentos).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${afastamentos}</p>`;
                    }
                    
                    html += `
                        <div style="margin-top: 20px; text-align: center;">
                            <button onclick="limparConteudo()" style="background: #e9e674; color: #26397f; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                                üóëÔ∏è Limpar Visualiza√ß√£o
                            </button>
                        </div>
                    </div>
                    `;
                    
                    showAlert('üö´ Exibindo afastamentos', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar afastamentos:', error);
                    showAlert('‚ùå Erro ao carregar afastamentos', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum afastamento encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarDenuncias() {
            const denunciasData = localStorage.getItem('denuncias');
            
            if (denunciasData) {
                try {
                    const denuncias = JSON.parse(denunciasData);
                    const timestamp = localStorage.getItem('denuncias_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üö® Den√∫ncias</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(denuncias)) {
                        html += `<p><strong>Total de den√∫ncias:</strong> ${denuncias.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem tabela complexa
                        if (denuncias.length > 0) {
                            html += `<p><strong>Primeiras den√∫ncias:</strong></p>`;
                            denuncias.slice(0, 5).forEach((denuncia, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(denuncia).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (denuncias.length > 5) {
                                html += `<p><em>... e mais ${denuncias.length - 5} den√∫ncias</em></p>`;
                            }
                        }
                    } else if (typeof denuncias === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(denuncias).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${denuncias}</p>`;
                    }
                    
                    html += `</div>`;
                    
                    showAlert('üö® Exibindo den√∫ncias', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar den√∫ncias:', error);
                    showAlert('‚ùå Erro ao carregar den√∫ncias', 'error');
                }
            } else {
                showAlert('‚ùå Nenhuma den√∫ncia encontrada. Baixe primeiro!', 'error');
            }
        }

        function visualizarOutrosProfissionais() {
            const profissionaisData = localStorage.getItem('outros_profissionais');
            
            if (profissionaisData) {
                try {
                    const profissionais = JSON.parse(profissionaisData);
                    const timestamp = localStorage.getItem('outros_profissionais_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üë®‚Äç‚öïÔ∏è Outros Profissionais</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(profissionais)) {
                        html += `<p><strong>Total de profissionais:</strong> ${profissionais.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem tabela complexa
                        if (profissionais.length > 0) {
                            html += `<p><strong>Primeiros profissionais:</strong></p>`;
                            profissionais.slice(0, 5).forEach((profissional, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(profissional).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (profissionais.length > 5) {
                                html += `<p><em>... e mais ${profissionais.length - 5} profissionais</em></p>`;
                            }
                        }
                    } else if (typeof profissionais === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(profissionais).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${profissionais}</p>`;
                    }
                    
                    html += `</div>`;
                    
                    showAlert('üë®‚Äç‚öïÔ∏è Exibindo outros profissionais', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar outros profissionais:', error);
                    showAlert('‚ùå Erro ao carregar outros profissionais', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum outro profissional encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarOutrosVinculos() {
            const vinculosData = localStorage.getItem('outros_vinculos');
            
            if (vinculosData) {
                try {
                    const vinculos = JSON.parse(vinculosData);
                    const timestamp = localStorage.getItem('outros_vinculos_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>üîó Outros V√≠nculos</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(vinculos)) {
                        html += `<p><strong>Total de v√≠nculos:</strong> ${vinculos.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem tabela complexa
                        if (vinculos.length > 0) {
                            html += `<p><strong>Primeiros v√≠nculos:</strong></p>`;
                            vinculos.slice(0, 5).forEach((vinculo, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(vinculo).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (vinculos.length > 5) {
                                html += `<p><em>... e mais ${vinculos.length - 5} v√≠nculos</em></p>`;
                            }
                        }
                    } else if (typeof vinculos === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(vinculos).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${vinculos}</p>`;
                    }
                    
                    html += `</div>`;
                    
                    showAlert('üîó Exibindo outros v√≠nculos', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar outros v√≠nculos:', error);
                    showAlert('‚ùå Erro ao carregar outros v√≠nculos', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum outro v√≠nculo encontrado. Baixe primeiro!', 'error');
            }
        }

        function visualizarProcessosEticos() {
            const processosData = localStorage.getItem('processos_eticos');
            
            if (processosData) {
                try {
                    const processos = JSON.parse(processosData);
                    const timestamp = localStorage.getItem('processos_eticos_timestamp');
                    const data = new Date(parseInt(timestamp)).toLocaleString('pt-BR');
                    
                    let html = `
                        <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px;">
                            <h3>‚öñÔ∏è Processos √âticos</h3>
                            <p><strong>Baixado em:</strong> ${data}</p>
                    `;
                    
                    // Verificar se √© um array ou objeto e exibir adequadamente
                    if (Array.isArray(processos)) {
                        html += `<p><strong>Total de processos:</strong> ${processos.length}</p>`;
                        
                        // Mostrar apenas os dados principais, sem tabela complexa
                        if (processos.length > 0) {
                            html += `<p><strong>Primeiros processos:</strong></p>`;
                            processos.slice(0, 5).forEach((processo, index) => {
                                html += `<div style="background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #5abaa3;">`;
                                Object.entries(processo).forEach(([chave, valor]) => {
                                    if (valor && valor !== 'null' && valor !== '') {
                                        html += `<strong>${chave}:</strong> ${valor}<br>`;
                                    }
                                });
                                html += `</div>`;
                            });
                            
                            if (processos.length > 5) {
                                html += `<p><em>... e mais ${processos.length - 5} processos</em></p>`;
                            }
                        }
                    } else if (typeof processos === 'object') {
                        // Para objetos, mostrar campos principais
                        html += `<p><strong>Campos dispon√≠veis:</strong></p>`;
                        Object.entries(processos).forEach(([chave, valor]) => {
                            if (valor && valor !== 'null' && valor !== '') {
                                html += `<div style="background: #f8f9fa; padding: 8px; margin: 3px 0; border-radius: 4px;">`;
                                html += `<strong>${chave}:</strong> ${valor}`;
                                html += `</div>`;
                            }
                        });
                    } else {
                        html += `<p><strong>Valor:</strong> ${processos}</p>`;
                    }
                    
                    html += `</div>`;
                    
                    showAlert('‚öñÔ∏è Exibindo processos √©ticos', 'success');
                    document.getElementById('content').innerHTML = html;
                } catch (error) {
                    console.error('‚ùå Erro ao carregar processos √©ticos:', error);
                    showAlert('‚ùå Erro ao carregar processos √©ticos', 'error');
                }
            } else {
                showAlert('‚ùå Nenhum processo √©tico encontrado. Baixe primeiro!', 'error');
            }
        }

        function loadUserData() {
            const user = localStorage.getItem('user');
            const isAuthenticated = localStorage.getItem('isAuthenticated');

            if (!isAuthenticated || !user) {
                window.location.href = '/';
                return;
            }

            try {
                const userData = JSON.parse(user);
                userNameElement.textContent = userData.name;
                


            } catch (error) {
                console.error('Erro ao carregar dados do usu√°rio:', error);
                logout();
            }
        }

        // Carregar dados quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', loadUserData);

        // Verificar autentica√ß√£o a cada 5 minutos
        setInterval(() => {
            const isAuthenticated = localStorage.getItem('isAuthenticated');
            if (!isAuthenticated) {
                logout();
            }
        }, 300000); // 5 minutos
        
        // Fun√ß√£o para limpar o conte√∫do da √°rea de visualiza√ß√£o
        function limparConteudo() {
            document.getElementById('content').innerHTML = '';
            showAlert('üóëÔ∏è Visualiza√ß√£o limpa', 'success');
        }

    </script>
</body>
</html> 